###############################################################################
#
#     PACKAGE:  papamac's bash scripts and runtime environment (bash-scripts)
#        FILE:  option
#       TITLE:  Optionally install the bash-scripts afp.conf file
#    FUNCTION:  Install papamac's afp.conf file to support the netatalk daemon
#               on Raspbian.
#       USAGE:  source src/bash-scripts/option or p2pkg -o bash-scripts (see
#               examples below).
#      AUTHOR:  papamac
#     VERSION:  1.0.1
#        DATE:  December 31, 2019
#
#
# MIT LICENSE:
#
# Copyright (c) 2019 David A. Krause, aka papamac
#
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the "Software"), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
# copies of the Software, and to permit persons to whom the Software is
# furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in
# allcopies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
# SOFTWARE.
#
#
# DESCRIPTION:
#
# The Apple File Protocol (AFP) is implemented by the netatalk daemon in
# Raspbian.  The netatalk configuration is specified by the afp.conf file in
# the /etc/netatalk directory.  papamac's afp.conf is included in the bash-
# scripts package for convenience, but it is only applicable to Raspbian and
# NOT to Mac OS.  Hence, the installation of afp.conf is performed in this
# option script and not in the install script.  option should not be executed
# for a Mac OS installation.  Also note that the netatalk package must be
# installed in Raspbian before running the option script.
#
# option installs the bash-scripts/afp.conf file that has already been
# downloaded to the src sub-directory of the current working directory.  It
# first saves the existing /etc/netatalk/afp.conf to afp.conf.save, but only if
# there is no existing .save file.  Thus only the original afp.conf is saved.
# The saved file is available to be restored by the remove script.  After
# saving the original afp.conf file, option completes the installation by
# copying PWD/src/bash-scripts/afp.conf to /etc/netatalk.
#
# option is designed to be used with p2pkg.  This can be done as part of a
# complete install (Raspbian only) or separately.  Usage examples are as
# follows:
#
# sudo -E p2pkg -fio bash-scripts       # Download the bash-scripts package
#                                         from the ftp server and install it in
#                                         the HOME and current working
#                                         directories.  Additionally, install
#                                         afp.conf in /etc/netatalk.
# sudo p2pkg -fo bash-scripts           # Download the bash-scripts package
#                                         from the ftp server and install only
#                                         afp.conf.
# sudo p2pkg -o bash-scripts            # Install afp.conf from the existing
#                                         PWD/src/bash-scripts directory.
#
#
# DEPENDENCIES/LIMITATIONS:
#
# Because it changes files and directories owned by root, p2pkg -o must be
# executed using sudo.
#
###############################################################################

net=/etc/netatalk
infomsg "option: installing afp.conf in $y$t$net$n"
if [[ ! -f $net/afp.conf.save ]]; then
    mv $net/afp.conf $net/afp.conf.save
fi
cp $pkg/afp.conf $net
